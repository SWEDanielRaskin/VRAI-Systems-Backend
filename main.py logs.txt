      "text": "I found 4 appointments:\n\n1. Botox - Aug 14 at 10:00 AM\n2. Microneedling - Aug 14 at 12:30 PM\n3. Botox - Aug 15 at 03:00 PM\n4. Microneedling - Aug 15 at 03:30 PM\n\nPlease reply with the number of the appointment you'd like to cancel.",
      "to": [
        {
          "carrier": "OMNIPOINT COMMUNICATIONS MIDWEST OPERATIONS, LLC",
          "line_type": "Wireless",
          "phone_number": "+13132044895",
          "status": "sent"
        }
      ],
      "type": "SMS",
      "valid_until": "2025-08-11T06:13:37.731+00:00",
      "webhook_failover_url": "",
      "webhook_url": "https://vraisystems.up.railway.app/message";
    },
    "record_type": "event"
  },
  "meta": {
    "attempt": 1,
    "delivered_to": "https://vraisystems.up.railway.app/message";
  }
}
INFO:app:‚úÖ New message processed: 40319897-8c66-4b25-8341-3b2c0c0135e3 (Cache size: 4)
INFO:app:üì± Skipping outbound message: outbound
INFO:werkzeug:100.64.0.4 - - [11/Aug/2025 05:13:37] "POST /message HTTP/1.1" 200 -
INFO:app:üì± SMS received. Headers: {'Host': 'vraisystems.up.railway.app', 'User-Agent': 'telnyx-webhooks', 'Content-Length': '2024', 'Content-Type': 'application/json', 'Telnyx-Signature-Ed25519': 'Pje7i2efCTov9DrsgSfDYnd9tspasr3Pz/34PfkVDWqN/WdjdyT3B7n2vHBqlq59zNkKOy7chyZAxJc/KXccDQ==', 'Telnyx-Timestamp': '1754889221', 'X-Forwarded-For': '192.76.120.128', 'X-Forwarded-Host': 'vraisystems.up.railway.app', 'X-Forwarded-Proto': 'https', 'X-Railway-Edge': 'railway/us-east4-eqdc4a', 'X-Railway-Request-Id': 'nGLlfxzvTQykkefQBT7zVQ', 'X-Real-Ip': '192.76.120.128', 'X-Request-Start': '1754889221479', 'Accept-Encoding': 'gzip'}
INFO:app:üì± SMS data: {
  "data": {
    "event_type": "message.finalized",
    "id": "03e86c0f-8b98-477b-97a8-37c116b5ae59",
    "occurred_at": "2025-08-11T05:13:41.243+00:00",
    "payload": {
      "cc": [],
      "completed_at": "2025-08-11T05:13:41.243+00:00",
      "cost": {
        "amount": "0.0170",
        "currency": "USD"
      },
      "cost_breakdown": {
        "carrier_fee": {
          "amount": "0.00600",
          "currency": "USD"
        },
        "rate": {
          "amount": "0.01100",
          "currency": "USD"
        }
      },
      "direction": "outbound",
      "encoding": "GSM-7",
      "errors": [],
      "from": {
        "carrier": "Telnyx",
        "line_type": "Wireless",
        "phone_number": "+18773900002"
      },
      "id": "40319897-8c66-4b25-8341-3b2c0c0135e3",
      "media": [],
      "messaging_profile_id": "40019736-4349-4cde-8878-64c12ca9c70e",
      "organization_id": "8c8fdc6f-f1bb-4bad-a6d5-1a766f415bea",
      "parts": 2,
      "received_at": "2025-08-11T05:13:37.731+00:00",
      "record_type": "message",
      "sent_at": "2025-08-11T05:13:37.869+00:00",
      "tags": [],
      "tcr_campaign_billable": false,
      "tcr_campaign_id": null,
      "tcr_campaign_registered": null,
      "text": "I found 4 appointments:\n\n1. Botox - Aug 14 at 10:00 AM\n2. Microneedling - Aug 14 at 12:30 PM\n3. Botox - Aug 15 at 03:00 PM\n4. Microneedling - Aug 15 at 03:30 PM\n\nPlease reply with the number of the appointment you'd like to cancel.",
      "to": [
        {
          "carrier": "OMNIPOINT COMMUNICATIONS MIDWEST OPERATIONS, LLC",
          "line_type": "Wireless",
          "phone_number": "+13132044895",
          "status": "delivered"
        }
      ],
      "type": "SMS",
      "valid_until": "2025-08-11T06:13:37.731+00:00",
      "webhook_failover_url": "",
      "webhook_url": "https://vraisystems.up.railway.app/message";
    },
    "record_type": "event"
  },
  "meta": {
    "attempt": 1,
    "delivered_to": "https://vraisystems.up.railway.app/message";
  }
}
INFO:app:üîÑ Skipping duplicate message: 40319897-8c66-4b25-8341-3b2c0c0135e3
INFO:werkzeug:100.64.0.6 - - [11/Aug/2025 05:13:41] "POST /message HTTP/1.1" 200 -
INFO:app:üì± SMS received. Headers: {'Host': 'vraisystems.up.railway.app', 'User-Agent': 'telnyx-webhooks', 'Content-Length': '1648', 'Content-Type': 'application/json', 'Telnyx-Signature-Ed25519': '0webAylmk2qi5/wMyUVAXh6l1S6jpSI49JovAExpFblxBhuksN47N4QypkuT2dhDbtaAq3wq42RJtZbEQWSdBw==', 'Telnyx-Timestamp': '1754889227', 'X-Forwarded-For': '192.76.120.128', 'X-Forwarded-Host': 'vraisystems.up.railway.app', 'X-Forwarded-Proto': 'https', 'X-Railway-Edge': 'railway/us-east4-eqdc4a', 'X-Railway-Request-Id': 'UMok78JrSXSBNWWPwoOzXw', 'X-Real-Ip': '192.76.120.128', 'X-Request-Start': '1754889227414', 'Accept-Encoding': 'gzip'}
INFO:app:üì± SMS data: {
  "data": {
    "event_type": "message.received",
    "id": "0eec7949-3913-4820-8625-9cf350d41cd2",
    "occurred_at": "2025-08-11T05:13:47.288+00:00",
    "payload": {
      "autoresponse_type": null,
      "cc": [],
      "completed_at": null,
      "cost": {
        "amount": "0.0085",
        "currency": "USD"
      },
      "cost_breakdown": {
        "carrier_fee": {
          "amount": "0.00300",
          "currency": "USD"
        },
        "rate": {
          "amount": "0.00550",
          "currency": "USD"
        }
      },
      "direction": "inbound",
      "encoding": "GSM-7",
      "errors": [],
      "from": {
        "carrier": "T-Mobile USA",
        "line_type": "Wireless",
        "phone_number": "+13132044895"
      },
      "id": "0911d6e0-6506-4089-8978-e5814dfd7236",
      "is_spam": false,
      "media": [],
      "messaging_profile_id": "40019736-4349-4cde-8878-64c12ca9c70e",
      "organization_id": "8c8fdc6f-f1bb-4bad-a6d5-1a766f415bea",
      "parts": 1,
      "received_at": "2025-08-11T05:13:47.116+00:00",
      "record_type": "message",
      "sent_at": null,
      "subject": "",
      "tags": [],
      "text": "4",
      "to": [
        {
          "carrier": "Telnyx",
          "line_type": "Wireless",
          "phone_number": "+18773900002",
          "status": "webhook_delivered"
        }
      ],
      "type": "SMS",
      "valid_until": null,
      "webhook_failover_url": null,
      "webhook_url": "https://vraisystems.up.railway.app/message";
    },
    "record_type": "event"
  },
  "meta": {
    "attempt": 1,
    "delivered_to": "https://vraisystems.up.railway.app/message";
  }
}
INFO:app:‚úÖ New message processed: 0911d6e0-6506-4089-8978-e5814dfd7236 (Cache size: 5)
INFO:app:üì± Debug - Full payload direction: inbound
INFO:app:üì± Debug - From object: {'carrier': 'T-Mobile USA', 'line_type': 'Wireless', 'phone_number': '+13132044895'}
INFO:app:üì± Debug - To object: [{'carrier': 'Telnyx', 'line_type': 'Wireless', 'phone_number': '+18773900002', 'status': 'webhook_delivered'}]
INFO:app:üì± SMS conversation - Customer: +13132044895 ‚Üí Business: +18773900002
INFO:app:üì± Message: 4
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:ai_service:üí¨ AI chose conversational response (no function calls) for message: 'Please confirm cancellation of your Microneedling appointment on Aug 15 at 03:30 PM by replying with...'
INFO:ai_service:üîç SMS booking trigger similarity: 32% for response: 'Please confirm cancellation of your Microneedling appointment on Aug 15 at 03:30 PM by replying with...'
INFO:booking_verification_service:üìù Logged AI response for +13132044895: Please confirm cancellation of your Microneedling ...
INFO:database_service:‚úÖ Message exchange logged for +13132044895
INFO:root:[SSE] Broadcasting event to 0 clients: {"type": "new_message", "phone": "+13132044895"}
INFO:app:üîç Checking for notifications in conversation +13132044895
INFO:app:üîç Analyzing 96 messages after timestamp 2025-08-04T23:29:10.792452-04:00
INFO:ai_summarizer:üëΩ Notification detection using summary: 
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:ai_summarizer:üö® Notification detected: critical - AI Unable to Complete Appointment Cancellations
INFO:database_service:üîÑ Replacing existing notification: critical for +13132044895 (sms)
INFO:database_service:üîÑ Notification replaced: AI Unable to Complete Appointment Cancellations (ID: 11)
INFO:app:üö® Notification created: AI Unable to Complete Appointment Cancellations
INFO:root:[SSE] Broadcasting event to 0 clients: {"type": "notification_created"}
INFO:app:üì± Sending reply - Business: +18773900002 ‚Üí Customer: +13132044895
INFO:sms_service:üì± Sending SMS from +18773900002 to +13132044895: Please confirm cancellation of your Microneedling appointment on Aug 15 at 03:30 PM by replying with "yes" or "confirm."
INFO:sms_service:‚úÖ SMS sent successfully to +13132044895
INFO:app:üì± SMS response sent to +13132044895: Please confirm cancellation of your Microneedling appointment on Aug 15 at 03:30 PM by replying with "yes" or "confirm."
INFO:werkzeug:100.64.0.5 - - [11/Aug/2025 05:13:54] "POST /message HTTP/1.1" 200 -
NFO:app:üì± SMS received. Headers: {'Host': 'vraisystems.up.railway.app', 'User-Agent': 'telnyx-webhooks', 'Content-Length': '1873', 'Content-Type': 'application/json', 'Telnyx-Signature-Ed25519': 'L72Qq8Ztc4tk9eUwRZ4pFFTEVbOBxDb7aVjrQjZ1VpXsxx6z42ndZUQ+vyS7I3sHziGk2NZdtWze5zjW1yolAg==', 'Telnyx-Timestamp': '1754889234', 'X-Forwarded-For': '192.76.120.142', 'X-Forwarded-Host': 'vraisystems.up.railway.app', 'X-Forwarded-Proto': 'https', 'X-Railway-Edge': 'railway/us-east4-eqdc4a', 'X-Railway-Request-Id': 'QOtlj7ZDTDOzYzWlBT7zVQ', 'X-Real-Ip': '192.76.120.142', 'X-Request-Start': '1754889234387', 'Accept-Encoding': 'gzip'}
INFO:app:üì± SMS data: {
  "data": {
    "event_type": "message.sent",
    "id": "bf97bb2f-68e8-48b8-9834-9df94bb8e664",
    "occurred_at": "2025-08-11T05:13:54.194+00:00",
    "payload": {
      "cc": [],
      "completed_at": null,
      "cost": {
        "amount": "0.0085",
        "currency": "USD"
      },
      "cost_breakdown": {
        "carrier_fee": {
          "amount": "0.00300",
          "currency": "USD"
        },
        "rate": {
          "amount": "0.00550",
          "currency": "USD"
        }
      },
      "direction": "outbound",
      "encoding": "GSM-7",
      "errors": [],
      "from": {
        "carrier": "Telnyx",
        "line_type": "Wireless",
        "phone_number": "+18773900002"
      },
      "id": "40319897-8ca6-478d-8371-b45c3277bfe1",
      "media": [],
      "messaging_profile_id": "40019736-4349-4cde-8878-64c12ca9c70e",
      "organization_id": "8c8fdc6f-f1bb-4bad-a6d5-1a766f415bea",
      "parts": 1,
      "received_at": "2025-08-11T05:13:54.039+00:00",
      "record_type": "message",
      "sent_at": "2025-08-11T05:13:54.194+00:00",
      "tags": [],
      "tcr_campaign_billable": false,
      "tcr_campaign_id": null,
      "tcr_campaign_registered": null,
      "text": "Please confirm cancellation of your Microneedling appointment on Aug 15 at 03:30 PM by replying with \"yes\" or \"confirm.\"",
      "to": [
        {
          "carrier": "OMNIPOINT COMMUNICATIONS MIDWEST OPERATIONS, LLC",
          "line_type": "Wireless",
          "phone_number": "+13132044895",
          "status": "sent"
        }
      ],
      "type": "SMS",
      "valid_until": "2025-08-11T06:13:54.039+00:00",
      "webhook_failover_url": "",
      "webhook_url": "https://vraisystems.up.railway.app/message";
    },
    "record_type": "event"
  },
  "meta": {
    "attempt": 1,
    "delivered_to": "https://vraisystems.up.railway.app/message";
  }
}
INFO:app:‚úÖ New message processed: 40319897-8ca6-478d-8371-b45c3277bfe1 (Cache size: 6)
INFO:app:üì± Skipping outbound message: outbound
INFO:werkzeug:100.64.0.6 - - [11/Aug/2025 05:13:54] "POST /message HTTP/1.1" 200 -
INFO:app:üì± SMS received. Headers: {'Host': 'vraisystems.up.railway.app', 'User-Agent': 'telnyx-webhooks', 'Content-Length': '1910', 'Content-Type': 'application/json', 'Telnyx-Signature-Ed25519': 'McOkiK+qIC/wG5Vazw/WgvsQT5yYrAzEJYCPNuCNtWvcHBHDb9iLRLGQ+wZLeUTGM/+R/LAAMPnWiA7/wiGvBw==', 'Telnyx-Timestamp': '1754889235', 'X-Forwarded-For': '192.76.120.128', 'X-Forwarded-Host': 'vraisystems.up.railway.app', 'X-Forwarded-Proto': 'https', 'X-Railway-Edge': 'railway/us-east4-eqdc4a', 'X-Railway-Request-Id': '6sRExDDuQNS89dzyPvyhXg', 'X-Real-Ip': '192.76.120.128', 'X-Request-Start': '1754889235242', 'Accept-Encoding': 'gzip'}
INFO:app:üì± SMS data: {
  "data": {
    "event_type": "message.finalized",
    "id": "0c99a0b1-7b3d-434e-bca5-14812c32db7c",
    "occurred_at": "2025-08-11T05:13:55.037+00:00",
    "payload": {
      "cc": [],
      "completed_at": "2025-08-11T05:13:55.037+00:00",
      "cost": {
        "amount": "0.0085",
        "currency": "USD"
      },
      "cost_breakdown": {
        "carrier_fee": {
          "amount": "0.00300",
          "currency": "USD"
        },
        "rate": {
          "amount": "0.00550",
          "currency": "USD"
        }
      },
      "direction": "outbound",
      "encoding": "GSM-7",
      "errors": [],
      "from": {
        "carrier": "Telnyx",
        "line_type": "Wireless",
        "phone_number": "+18773900002"
      },
      "id": "40319897-8ca6-478d-8371-b45c3277bfe1",
      "media": [],
      "messaging_profile_id": "40019736-4349-4cde-8878-64c12ca9c70e",
      "organization_id": "8c8fdc6f-f1bb-4bad-a6d5-1a766f415bea",
      "parts": 1,
      "received_at": "2025-08-11T05:13:54.039+00:00",
      "record_type": "message",
        "sent_at": "2025-08-11T05:13:54.194+00:00",
      "tags": [],
      "tcr_campaign_billable": false,
      "tcr_campaign_id": null,
      "tcr_campaign_registered": null,
      "text": "Please confirm cancellation of your Microneedling appointment on Aug 15 at 03:30 PM by replying with \"yes\" or \"confirm.\"",
      "to": [
        {
          "carrier": "OMNIPOINT COMMUNICATIONS MIDWEST OPERATIONS, LLC",
          "line_type": "Wireless",
          "phone_number": "+13132044895",
          "status": "delivered"
        }
      ],
      "type": "SMS",
      "valid_until": "2025-08-11T06:13:54.039+00:00",
      "webhook_failover_url": "",
      "webhook_url": "https://vraisystems.up.railway.app/message";
    },
    "record_type": "event"
  },
  "meta": {
    "attempt": 1,
    "delivered_to": "https://vraisystems.up.railway.app/message";
  }
}
INFO:app:üîÑ Skipping duplicate message: 40319897-8ca6-478d-8371-b45c3277bfe1
INFO:werkzeug:100.64.0.7 - - [11/Aug/2025 05:13:55] "POST /message HTTP/1.1" 200 -
INFO:app:üì± SMS received. Headers: {'Host': 'vraisystems.up.railway.app', 'User-Agent': 'telnyx-webhooks', 'Content-Length': '1650', 'Content-Type': 'application/json', 'Telnyx-Signature-Ed25519': 'G+B0M83nv8X/NWQA0MkefY4tVETMxpfTvixSql6+UF0bENuwket1RfYibibL5luso9hvm6RUOb8waOuxC1dTDw==', 'Telnyx-Timestamp': '1754889240', 'X-Forwarded-For': '192.76.120.128', 'X-Forwarded-Host': 'vraisystems.up.railway.app', 'X-Forwarded-Proto': 'https', 'X-Railway-Edge': 'railway/us-east4-eqdc4a', 'X-Railway-Request-Id': 'cj_1DpgPQtSdotDkPvyhXg', 'X-Real-Ip': '192.76.120.128', 'X-Request-Start': '1754889240863', 'Accept-Encoding': 'gzip'}
INFO:app:üì± SMS data: {
  "data": {
    "event_type": "message.received",
    "id": "9b420d25-6bd5-4688-859c-25ae2c97d07a",
    "occurred_at": "2025-08-11T05:14:00.740+00:00",
    "payload": {
      "autoresponse_type": null,
      "cc": [],
      "completed_at": null,
      "cost": {
        "amount": "0.0085",
        "currency": "USD"
      },
      "cost_breakdown": {
        "carrier_fee": {
          "amount": "0.00300",
          "currency": "USD"
        },
        "rate": {
          "amount": "0.00550",
          "currency": "USD"
        }
      },
      "direction": "inbound",
      "encoding": "GSM-7",
      "errors": [],
      "from": {
        "carrier": "T-Mobile USA",
        "line_type": "Wireless",
        "phone_number": "+13132044895"
      },
      "id": "00171bd1-3f03-479c-b704-a2b7cde31f64",
      "is_spam": false,
      "media": [],
      "messaging_profile_id": "40019736-4349-4cde-8878-64c12ca9c70e",
      "organization_id": "8c8fdc6f-f1bb-4bad-a6d5-1a766f415bea",
      "parts": 1,
      "received_at": "2025-08-11T05:14:00.562+00:00",
      "record_type": "message",
      "sent_at": null,
      "subject": "",
      "tags": [],
      "text": "yes",
      "to": [
        {
          "carrier": "Telnyx",
          "line_type": "Wireless",
          "phone_number": "+18773900002",
          "status": "webhook_delivered"
        }
      ],
      "type": "SMS",
      "valid_until": null,
      "webhook_failover_url": null,
      "webhook_url": "https://vraisystems.up.railway.app/message";
    },
    "record_type": "event"
  },
  "meta": {
    "attempt": 1,
    "delivered_to": "https://vraisystems.up.railway.app/message";
  }
}
INFO:app:‚úÖ New message processed: 00171bd1-3f03-479c-b704-a2b7cde31f64 (Cache size: 7)
INFO:app:üì± Debug - Full payload direction: inbound
INFO:app:üì± Debug - From object: {'carrier': 'T-Mobile USA', 'line_type': 'Wireless', 'phone_number': '+13132044895'}
INFO:app:üì± Debug - To object: [{'carrier': 'Telnyx', 'line_type': 'Wireless', 'phone_number': '+18773900002', 'status': 'webhook_delivered'}]
INFO:app:üì± SMS conversation - Customer: +13132044895 ‚Üí Business: +18773900002
INFO:app:üì± Message: yes
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:ai_service:üîß AI chose to call functions: 1 function(s)
INFO:ai_service:üîß AI calling function: confirm_cancellation with args: {'confirmation': 'yes'}
INFO:ai_service:üîß AI calling function: confirm_cancellation with args: {'confirmation': 'yes'}
INFO:ai_service:üîß Executing function: confirm_cancellation with arguments: {'confirmation': 'yes'}
INFO:ai_service:üóëÔ∏è SMS Cancellation - Confirming cancellation with response: yes
INFO:ai_service:üîç SMS Cancellation - State machine data: {'phone': '+13132044895'}
INFO:ai_service:üîç SMS Cancellation - Found appointments: 4
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:ai_service:üîç SMS booking trigger similarity: 31% for response: 'It seems there was an issue with the cancellation. Please confirm again to cancel your Microneedling...'
INFO:booking_verification_service:üìù Logged AI response for +13132044895: It seems there was an issue with the cancellation....
INFO:database_service:‚úÖ Message exchange logged for +13132044895
INFO:root:[SSE] Broadcasting event to 0 clients: {"type": "new_message", "phone": "+13132044895"}
INFO:app:üìù Generating/updating AI summary for conversation +13132044895 (messages: 152)
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:ai_summarizer:üë§ AI extracted customer name from SMS: 'Daniel' for +13132044895
INFO:ai_summarizer:üë§ Found customer name in database: 'Daniel Raskin' for +13132044895
INFO:ai_summarizer:üë§ Using database name override: 'Daniel Raskin' (AI extracted: 'Daniel') for +13132044895
INFO:ai_summarizer:‚úÖ Generated SMS summary: Customer, Daniel, booked multiple appointments inc...
INFO:database_service:‚úÖ Summary updated for conversation +13132044895
INFO:database_service:‚úÖ Summary message count updated for conversation +13132044895: 152
INFO:app:üîç Checking for notifications in conversation +13132044895
INFO:app:üîç Analyzing 98 messages after timestamp 2025-08-04T23:29:10.792452-04:00
INFO:ai_summarizer:üëΩ Notification detection using summary: 
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:ai_summarizer:üö® Notification detected: critical - Repeated failure to process appointment cancellations
INFO:database_service:üîÑ Replacing existing notification: critical for +13132044895 (sms)
INFO:database_service:üîÑ Notification replaced: Repeated failure to process appointment cancellations (ID: 11)
INFO:app:üö® Notification created: Repeated failure to process appointment cancellations
INFO:root:[SSE] Broadcasting event to 0 clients: {"type": "notification_created"}
INFO:app:üì± Sending reply - Business: +18773900002 ‚Üí Customer: +13132044895
INFO:sms_service:üì± Sending SMS from +18773900002 to +13132044895: It seems there was an issue with the cancellation. Please confirm again to cancel your Microneedling appointment on Aug 15 at 03:30 PM by replying with "yes."
INFO:sms_service:‚úÖ SMS sent successfully to +13132044895
INFO:app:üì± SMS response sent to +13132044895: It seems there was an issue with the cancellation. Please confirm again to cancel your Microneedling appointment on Aug 15 at 03:30 PM by replying with "yes."
INFO:werkzeug:100.64.0.7 - - [11/Aug/2025 05:14:05] "POST /message HTTP/1.1" 200 -
INFO:app:üì± SMS received. Headers: {'Host': 'vraisystems.up.railway.app', 'User-Agent': 'telnyx-webhooks', 'Content-Length': '1909', 'Content-Type': 'application/json', 'Telnyx-Signature-Ed25519': 'kxeMNziBe/G9ATNXFtkNktTKGqgj41zEYVMm1Q2ue0v4eEDcBxZPi7eF29w2GySNF1vfIpf7CybbRrb0zmdADg==', 'Telnyx-Timestamp': '1754889245', 'X-Forwarded-For': '192.76.120.142', 'X-Forwarded-Host': 'vraisystems.up.railway.app', 'X-Forwarded-Proto': 'https', 'X-Railway-Edge': 'railway/us-east4-eqdc4a', 'X-Railway-Request-Id': 'YvxmXmtVRt6CZifXozsQ6Q', 'X-Real-Ip': '192.76.120.142', 'X-Request-Start': '1754889245386', 'Accept-Encoding': 'gzip'}
INFO:app:üì± SMS data: {
  "data": {
    "event_type": "message.sent",
    "id": "b66a49cb-a2e6-4c5e-ac9f-fcaf3c81163f",
    "occurred_at": "2025-08-11T05:14:05.295+00:00",
    "payload": {
      "cc": [],
      "completed_at": null,
      "cost": {
        "amount": "0.0085",
        "currency": "USD"
      },
      "cost_breakdown": {
        "carrier_fee": {
          "amount": "0.00300",
          "currency": "USD"
        },
        "rate": {
          "amount": "0.00550",
          "currency": "USD"
        }
      },
      "direction": "outbound",
      "encoding": "GSM-7",
      "errors": [],
      "from": {
        "carrier": "Telnyx",
        "line_type": "Wireless",
        "phone_number": "+18773900002"
      },
      "id": "40319897-8cd1-4ed0-a193-0c7445befd6a",
      "media": [],
      "messaging_profile_id": "40019736-4349-4cde-8878-64c12ca9c70e",
      "organization_id": "8c8fdc6f-f1bb-4bad-a6d5-1a766f415bea",
      "parts": 1,
      "received_at": "2025-08-11T05:14:05.162+00:00",
      "record_type": "message",
      "sent_at": "2025-08-11T05:14:05.295+00:00",
      "tags": [],
      "tcr_campaign_billable": false,
      "tcr_campaign_id": null,
      "tcr_campaign_registered": null,
      "text": "It seems there was an issue with the cancellation. Please confirm again to cancel your Microneedling appointment on Aug 15 at 03:30 PM by replying with \"yes.\"",
      "to": [
        {
          "carrier": "OMNIPOINT COMMUNICATIONS MIDWEST OPERATIONS, LLC",
          "line_type": "Wireless",
          "phone_number": "+13132044895",
          "status": "sent"
        }
      ],
      "type": "SMS",
      "valid_until": "2025-08-11T06:14:05.162+00:00",
      "webhook_failover_url": "",
      "webhook_url": "https://vraisystems.up.railway.app/message";
    },
    "record_type": "event"
  },
  "meta": {
    "attempt": 1,
    "delivered_to": "https://vraisystems.up.railway.app/message";
  }
}
INFO:app:‚úÖ New message processed: 40319897-8cd1-4ed0-a193-0c7445befd6a (Cache size: 8)
INFO:app:üì± Skipping outbound message: outbound
INFO:werkzeug:100.64.0.4 - - [11/Aug/2025 05:14:05] "POST /message HTTP/1.1" 200 -
INFO:app:üì± SMS received. Headers: {'Host': 'vraisystems.up.railway.app', 'User-Agent': 'telnyx-webhooks', 'Content-Length': '1946', 'Content-Type': 'application/json', 'Telnyx-Signature-Ed25519': 'dZWgvwHzdCAgTSC/iodwZK4FCFNgTpujlq5Ip/8H5b0EAywOMR6ihbt8Rh6whdGoSQTh1Z5R7q9ueM/HXA3sDQ==', 'Telnyx-Timestamp': '1754889246', 'X-Forwarded-For': '192.76.120.128', 'X-Forwarded-Host': 'vraisystems.up.railway.app', 'X-Forwarded-Proto': 'https', 'X-Railway-Edge': 'railway/us-east4-eqdc4a', 'X-Railway-Request-Id': 'TisPS3gTSEGJX9DAwoOzXw', 'X-Real-Ip': '192.76.120.128', 'X-Request-Start': '1754889246212', 'Accept-Encoding': 'gzip'}
INFO:app:üì± SMS data: {
  "data": {
    "event_type": "message.finalized",
    "id": "ff40e3b3-3500-49ce-b1f7-92dfadb388b6",
    "occurred_at": "2025-08-11T05:14:06.164+00:00",
    "payload": {
      "cc": [],
      "completed_at": "2025-08-11T05:14:06.164+00:00",
      "cost": {
        "amount": "0.0085",
        "currency": "USD"
      },
      "cost_breakdown": {
        "carrier_fee": {
          "amount": "0.00300",
          "currency": "USD"
        },
        "rate": {
          "amount": "0.00550",
          "currency": "USD"
        }
      },
      "direction": "outbound",
      "encoding": "GSM-7",
      "errors": [],
      "from": {
        "carrier": "Telnyx",
        "line_type": "Wireless",
        "phone_number": "+18773900002"
      },
      "id": "40319897-8cd1-4ed0-a193-0c7445befd6a",
      "media": [],
      "messaging_profile_id": "40019736-4349-4cde-8878-64c12ca9c70e",
      "organization_id": "8c8fdc6f-f1bb-4bad-a6d5-1a766f415bea",
      "parts": 1,
      "received_at": "2025-08-11T05:14:05.162+00:00",
      "record_type": "message",
      "sent_at": "2025-08-11T05:14:05.295+00:00",
      "tags": [],
      "tcr_campaign_billable": false,
      "tcr_campaign_id": null,
      "tcr_campaign_registered": null,
      "text": "It seems there was an issue with the cancellation. Please confirm again to cancel your Microneedling appointment on Aug 15 at 03:30 PM by replying with \"yes.\"",
      "to": [
        {
          "carrier": "OMNIPOINT COMMUNICATIONS MIDWEST OPERATIONS, LLC",
          "line_type": "Wireless",
          "phone_number": "+13132044895",
          "status": "delivered"
        }
      ],
      "type": "SMS",
      "valid_until": "2025-08-11T06:14:05.162+00:00",
      "webhook_failover_url": "",
      "webhook_url": "https://vraisystems.up.railway.app/message";
    },
    "record_type": "event"
  },
  "meta": {
    "attempt": 1,
    "delivered_to": "https://vraisystems.up.railway.app/message";
  }
}
INFO:app:üîÑ Skipping duplicate message: 40319897-8cd1-4ed0-a193-0c7445befd6a
INFO:werkzeug:100.64.0.5 - - [11/Aug/2025 05:14:06] "POST /message HTTP/1.1" 200 -
INFO:app:üì± SMS received. Headers: {'Host': 'vraisystems.up.railway.app', 'User-Agent': 'telnyx-webhooks', 'Content-Length': '1650', 'Content-Type': 'application/json', 'Telnyx-Signature-Ed25519': 'fndNIdAe+jNb7xYV+qiJ6quY4TtXk7w44Ut/ksXsFnksiyOqhBKfhLG3m5Ev+0TJuBTLTszq1jaLd4xN6dORDg==', 'Telnyx-Timestamp': '1754889273', 'X-Forwarded-For': '192.76.120.142', 'X-Forwarded-Host': 'vraisystems.up.railway.app', 'X-Forwarded-Proto': 'https', 'X-Railway-Edge': 'railway/us-east4-eqdc4a', 'X-Railway-Request-Id': '1YyDv3-YQLKtTiZQCx5-qw', 'X-Real-Ip': '192.76.120.142', 'X-Request-Start': '1754889273446', 'Accept-Encoding': 'gzip'}
INFO:app:üì± SMS data: {
  "data": {
    "event_type": "message.received",
    "id": "f8595117-f787-45ec-ad5d-06a45bdcb828",
    "occurred_at": "2025-08-11T05:14:33.143+00:00",
    "payload": {
      "autoresponse_type": null,
      "cc": [],
      "completed_at": null,
      "cost": {
        "amount": "0.0085",
        "currency": "USD"
      },
      "cost_breakdown": {
        "carrier_fee": {
          "amount": "0.00300",
          "currency": "USD"
        },
        "rate": {
          "amount": "0.00550",
          "currency": "USD"
        }
      },
      "direction": "inbound",
      "encoding": "GSM-7",
      "errors": [],
      "from": {
        "carrier": "T-Mobile USA",
        "line_type": "Wireless",
        "phone_number": "+13132044895"
      },
      "id": "371c56f5-6012-44dd-b7c0-4fdbb28979da",
      "is_spam": false,
      "media": [],
      "messaging_profile_id": "40019736-4349-4cde-8878-64c12ca9c70e",
      "organization_id": "8c8fdc6f-f1bb-4bad-a6d5-1a766f415bea",
      "parts": 1,
      "received_at": "2025-08-11T05:14:32.833+00:00",
      "record_type": "message",
      "sent_at": null,
      "subject": "",
      "tags": [],
      "text": "yes",
      "to": [
        {
          "carrier": "Telnyx",
          "line_type": "Wireless",
          "phone_number": "+18773900002",
          "status": "webhook_delivered"
        }
      ],
      "type": "SMS",
      "valid_until": null,
      "webhook_failover_url": null,
      "webhook_url": "https://vraisystems.up.railway.app/message";
    },
    "record_type": "event"
  },
  "meta": {
    "attempt": 1,
    "delivered_to": "https://vraisystems.up.railway.app/message";
  }
}
INFO:app:‚úÖ New message processed: 371c56f5-6012-44dd-b7c0-4fdbb28979da (Cache size: 9)
INFO:app:üì± Debug - Full payload direction: inbound
INFO:app:üì± Debug - From object: {'carrier': 'T-Mobile USA', 'line_type': 'Wireless', 'phone_number': '+13132044895'}
INFO:app:üì± Debug - To object: [{'carrier': 'Telnyx', 'line_type': 'Wireless', 'phone_number': '+18773900002', 'status': 'webhook_delivered'}]
INFO:app:üì± SMS conversation - Customer: +13132044895 ‚Üí Business: +18773900002
INFO:app:üì± Message: yes
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:ai_service:üîß AI chose to call functions: 1 function(s)
INFO:ai_service:üîß AI calling function: confirm_cancellation with args: {'confirmation': 'yes'}
INFO:ai_service:üîß AI calling function: confirm_cancellation with args: {'confirmation': 'yes'}
INFO:ai_service:üîß Executing function: confirm_cancellation with arguments: {'confirmation': 'yes'}
INFO:ai_service:üóëÔ∏è SMS Cancellation - Confirming cancellation with response: yes
INFO:ai_service:üîç SMS Cancellation - State machine data: {'phone': '+13132044895'}
INFO:ai_service:üîç SMS Cancellation - Found appointments: 4
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:ai_service:üîç SMS booking trigger similarity: 39% for response: 'It seems I can't process the cancellation. Please provide the phone number again to start over....'
INFO:booking_verification_service:üìù Logged AI response for +13132044895: It seems I can't process the cancellation. Please ...
INFO:database_service:‚úÖ Message exchange logged for +13132044895
INFO:root:[SSE] Broadcasting event to 0 clients: {"type": "new_message", "phone": "+13132044895"}
INFO:app:üîç Checking for notifications in conversation +13132044895
INFO:app:üîç Analyzing 100 messages after timestamp 2025-08-04T23:29:10.792452-04:00
INFO:ai_summarizer:üëΩ Notification detection using summary: 
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:ai_summarizer:üö® Notification detected: critical - Repeated failure to process appointment cancellations
INFO:database_service:üîÑ Replacing existing notification: critical for +13132044895 (sms)
INFO:database_service:üîÑ Notification replaced: Repeated failure to process appointment cancellations (ID: 11)
INFO:app:üö® Notification created: Repeated failure to process appointment cancellations
INFO:root:[SSE] Broadcasting event to 0 clients: {"type": "notification_created"}
INFO:app:üì± Sending reply - Business: +18773900002 ‚Üí Customer: +13132044895
INFO:sms_service:üì± Sending SMS from +18773900002 to +13132044895: It seems I can't process the cancellation. Please provide the phone number again to start over.
INFO:sms_service:‚úÖ SMS sent successfully to +13132044895
INFO:app:üì± SMS response sent to +13132044895: It seems I can't process the cancellation. Please provide the phone number again to start over.
INFO:werkzeug:100.64.0.8 - - [11/Aug/2025 05:14:35] "POST /message HTTP/1.1" 200 -
INFO:app:üì± SMS received. Headers: {'Host': 'vraisystems.up.railway.app', 'User-Agent': 'telnyx-webhooks', 'Content-Length': '1844', 'Content-Type': 'application/json', 'Telnyx-Signature-Ed25519': '6wZwvEex59BM8j0oTrgn3YkP32wb5MKO1MFfLSUCCgKCQ/2FX0Xp5DGICPkIfnC/thjRRiQxtlSF4GGQ8GChDQ==', 'Telnyx-Timestamp': '1754889275', 'X-Forwarded-For': '192.76.120.142', 'X-Forwarded-Host': 'vraisystems.up.railway.app', 'X-Forwarded-Proto': 'https', 'X-Railway-Edge': 'railway/us-east4-eqdc4a', 'X-Railway-Request-Id': 'HRMZEUzRQDCFVWRcPvyhXg', 'X-Real-Ip': '192.76.120.142', 'X-Request-Start': '1754889276051', 'Accept-Encoding': 'gzip'}
